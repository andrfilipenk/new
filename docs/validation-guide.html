<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validation System Guide - Framework Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; }
        .container { max-width: 1200px; }
        .page-header { border-bottom: 2px solid #667eea; padding-bottom: 1rem; margin-bottom: 2rem; }
        .page-title { color: #667eea; font-weight: 700; margin: 0; }
        .code-example { background: #2d3748; border-radius: 8px; padding: 1.5rem; margin: 1rem 0; position: relative; }
        .code-example::before { content: attr(data-title); position: absolute; top: 0; left: 0; background: #667eea; color: white; padding: 0.25rem 0.75rem; border-radius: 8px 0 8px 0; font-size: 0.75rem; font-weight: 600; }
        .toc { background: #f8f9fa; border-left: 4px solid #667eea; padding: 1rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
        .alert-info { background: linear-gradient(135deg, #e3f2fd, #bbdefb); border: 1px solid #2196f3; color: #0d47a1; }
        .alert-warning { background: linear-gradient(135deg, #fff3e0, #ffcc02); border: 1px solid #ff9800; color: #e65100; }
        .alert-success { background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border: 1px solid #4caf50; color: #1b5e20; }
        .nav-pills .nav-link { margin: 0.25rem; }
        .nav-pills .nav-link.active { background-color: #667eea; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- Navigation -->
        <nav class="mb-4">
            <ul class="nav nav-pills">
                <li class="nav-item"><a class="nav-link" href="index.html">Overview</a></li>
                <li class="nav-item"><a class="nav-link" href="installation-guide.html">Installation</a></li>
                <li class="nav-item"><a class="nav-link" href="mvc-guide.html">MVC</a></li>
                <li class="nav-item"><a class="nav-link" href="database-guide.html">Database</a></li>
                <li class="nav-item"><a class="nav-link" href="acl-guide.html">ACL</a></li>
                <li class="nav-item"><a class="nav-link active" href="validation-guide.html">Validation</a></li>
                <li class="nav-item"><a class="nav-link" href="forms-guide.html">Forms</a></li>
                <li class="nav-item"><a class="nav-link" href="api-guide.html">API</a></li>
                <li class="nav-item"><a class="nav-link" href="testing-guide.html">Testing</a></li>
                <li class="nav-item"><a class="nav-link" href="best-practices-guide.html">Best Practices</a></li>
            </ul>
        </nav>

        <!-- Content -->
        <div class="bg-white rounded p-4 shadow-sm">
            <div class="page-header">
                <h1 class="page-title">Validation System</h1>
                <p class="page-subtitle text-muted">Input validation, custom rules, and form security</p>
            </div>

            <div class="toc">
                <h6>Table of Contents</h6>
                <ul>
                    <li><a href="#validation-basics">Validation Basics</a></li>
                    <li><a href="#built-in-rules">Built-in Rules</a></li>
                    <li><a href="#custom-rules">Custom Rules</a></li>
                    <li><a href="#form-validation">Form Validation</a></li>
                    <li><a href="#ajax-validation">AJAX Validation</a></li>
                    <li><a href="#security-features">Security Features</a></li>
                </ul>
            </div>

            <h2 id="validation-basics">Validation Basics</h2>
            <p>The validation system provides comprehensive input validation with built-in rules, custom validation, and security features.</p>

            <h3>Basic Validation</h3>
            <div class="code-example" data-title="Controller Validation">
                <pre><code class="language-php"><?php
namespace App\Controllers;

class UserController extends Controller
{
    public function store()
    {
        $validator = new Validator();
        
        $rules = [
            'name' => 'required|min:2|max:50',
            'email' => 'required|email|unique:user,email',
            'password' => 'required|min:8|confirmed',
            'age' => 'required|integer|between:18,100'
        ];
        
        $messages = [
            'name.required' => 'Name is required',
            'email.email' => 'Please enter a valid email address',
            'password.min' => 'Password must be at least 8 characters',
            'password.confirmed' => 'Password confirmation does not match'
        ];
        
        $validation = $validator->validate($_POST, $rules, $messages);
        
        if ($validation->fails()) {
            return redirect()->back()
                ->withErrors($validation->errors())
                ->withInput();
        }
        
        // Validation passed, create user
        User::create($validation->validated());
        
        return redirect('/users')->with('success', 'User created successfully');
    }
}</code></pre>
            </div>

            <h3>Validator Class</h3>
            <div class="code-example" data-title="app/Core/Validator.php">
                <pre><code class="language-php"><?php
namespace App\Core;

class Validator
{
    protected $data = [];
    protected $rules = [];
    protected $messages = [];
    protected $errors = [];
    
    public function validate($data, $rules, $messages = [])
    {
        $this->data = $data;
        $this->rules = $rules;
        $this->messages = $messages;
        $this->errors = [];
        
        foreach ($rules as $field => $ruleString) {
            $this->validateField($field, $ruleString);
        }
        
        return new ValidationResult($this->errors, $data);
    }
    
    protected function validateField($field, $ruleString)
    {
        $rules = explode('|', $ruleString);
        $value = $this->getValue($field);
        
        foreach ($rules as $rule) {
            $this->applyRule($field, $rule, $value);
        }
    }
    
    protected function applyRule($field, $rule, $value)
    {
        if (strpos($rule, ':') !== false) {
            [$ruleName, $parameter] = explode(':', $rule, 2);
        } else {
            $ruleName = $rule;
            $parameter = null;
        }
        
        $method = 'validate' . ucfirst($ruleName);
        
        if (method_exists($this, $method)) {
            if (!$this->$method($field, $value, $parameter)) {
                $this->addError($field, $ruleName, $parameter);
            }
        }
    }
}</code></pre>
            </div>

            <h2 id="built-in-rules">Built-in Validation Rules</h2>

            <div class="row">
                <div class="col-md-6">
                    <h5>Required Rules</h5>
                    <ul>
                        <li><code>required</code> - Field must be present</li>
                        <li><code>required_if:field,value</code> - Required if another field has value</li>
                        <li><code>required_with:field</code> - Required with another field</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>String Rules</h5>
                    <ul>
                        <li><code>min:3</code> - Minimum length</li>
                        <li><code>max:50</code> - Maximum length</li>
                        <li><code>alpha</code> - Only letters</li>
                        <li><code>alpha_num</code> - Letters and numbers</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Numeric Rules</h5>
                    <ul>
                        <li><code>integer</code> - Must be integer</li>
                        <li><code>numeric</code> - Must be numeric</li>
                        <li><code>between:1,100</code> - Between values</li>
                        <li><code>positive</code> - Positive number</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Format Rules</h5>
                    <ul>
                        <li><code>email</code> - Valid email format</li>
                        <li><code>url</code> - Valid URL</li>
                        <li><code>date</code> - Valid date</li>
                        <li><code>regex:/pattern/</code> - Custom regex</li>
                    </ul>
                </div>
            </div>

            <h3>Built-in Rule Examples</h3>
            <div class="code-example" data-title="Validation Rules Implementation">
                <pre><code class="language-php"><?php
class Validator
{
    protected function validateRequired($field, $value, $parameter)
    {
        return !empty($value) || $value === '0' || $value === 0;
    }
    
    protected function validateEmail($field, $value, $parameter)
    {
        return filter_var($value, FILTER_VALIDATE_EMAIL) !== false;
    }
    
    protected function validateMin($field, $value, $parameter)
    {
        if (is_string($value)) {
            return strlen($value) >= (int)$parameter;
        }
        return (int)$value >= (int)$parameter;
    }
    
    protected function validateMax($field, $value, $parameter)
    {
        if (is_string($value)) {
            return strlen($value) <= (int)$parameter;
        }
        return (int)$value <= (int)$parameter;
    }
    
    protected function validateUnique($field, $value, $parameter)
    {
        [$table, $column] = explode(',', $parameter);
        
        $db = Container::getDefault()->get('db');
        $count = $db->table($table)
            ->where($column, $value)
            ->count();
            
        return $count === 0;
    }
    
    protected function validateConfirmed($field, $value, $parameter)
    {
        $confirmField = $field . '_confirmation';
        $confirmValue = $this->getValue($confirmField);
        
        return $value === $confirmValue;
    }
}</code></pre>
            </div>

            <h2 id="custom-rules">Custom Validation Rules</h2>

            <h3>Creating Custom Rules</h3>
            <div class="code-example" data-title="Custom Rule Registration">
                <pre><code class="language-php"><?php
class Validator
{
    protected $customRules = [];
    
    public function addRule($name, $callback, $message = null)
    {
        $this->customRules[$name] = [
            'callback' => $callback,
            'message' => $message
        ];
    }
    
    protected function applyRule($field, $rule, $value)
    {
        
        // Check custom rules
        if (isset($this->customRules[$ruleName])) {
            $callback = $this->customRules[$ruleName]['callback'];
            if (!call_user_func($callback, $value, $parameter, $this->data)) {
                $this->addError($field, $ruleName, $parameter);
            }
            return;
        }
        
        // ... rest of method
    }
}

// Usage
$validator = new Validator();

// Custom rule for strong password
$validator->addRule('strong_password', function($value) {
    return preg_match('/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/', $value);
}, 'Password must contain uppercase, lowercase, number, and special character');

// Custom rule for phone number
$validator->addRule('phone', function($value) {
    return preg_match('/^\+?[1-9]\d{1,14}$/', $value);
}, 'Please enter a valid phone number');</code></pre>
            </div>

            <h2 id="form-validation">Form Validation</h2>

            <h3>Form Request Validation</h3>
            <div class="code-example" data-title="app/Requests/CreateUserRequest.php">
                <pre><code class="language-php"><?php
namespace App\Requests;

class CreateUserRequest extends FormRequest
{
    public function rules()
    {
        return [
            'name' => 'required|min:2|max:50|alpha',
            'email' => 'required|email|unique:user,email',
            'password' => 'required|min:8|strong_password|confirmed',
            'birth_date' => 'required|date|before:today',
            'phone' => 'required|phone',
            'terms' => 'required|accepted'
        ];
    }
    
    public function messages()
    {
        return [
            'name.alpha' => 'Name can only contain letters',
            'birth_date.before' => 'Birth date must be in the past',
            'terms.accepted' => 'You must accept the terms and conditions'
        ];
    }
    
    public function authorize()
    {
        return true; // Allow all users to create accounts
    }
}

// Controller usage
class UserController extends Controller
{
    public function store(CreateUserRequest $request)
    {
        // Validation already passed
        $validated = $request->validated();
        
        User::create($validated);
        
        return redirect('/users');
    }
}</code></pre>
            </div>

            <h2 id="ajax-validation">AJAX Validation</h2>

            <div class="code-example" data-title="Real-time Validation">
                <pre><code class="language-php"><?php
class UserController extends Controller
{
    public function validateField()
    {
        $field = $_POST['field'];
        $value = $_POST['value'];
        
        $rules = [
            'email' => 'required|email|unique:user,email',
            'username' => 'required|min:3|max:20|alpha_num|unique:user,username'
        ];
        
        if (!isset($rules[$field])) {
            return response()->json(['error' => 'Invalid field'], 400);
        }
        
        $validator = new Validator();
        $validation = $validator->validate([$field => $value], [$field => $rules[$field]]);
        
        if ($validation->fails()) {
            return response()->json([
                'valid' => false,
                'errors' => $validation->errors()
            ]);
        }
        
        return response()->json(['valid' => true]);
    }
}</code></pre>
            </div>

            <div class="code-example" data-title="JavaScript Integration">
                <pre><code class="language-javascript">// Real-time field validation
function validateField(field, value) {
    fetch('/validate-field', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
        },
        body: JSON.stringify({
            field: field,
            value: value
        })
    })
    .then(response => response.json())
    .then(data => {
        const fieldElement = document.getElementById(field);
        const errorElement = document.getElementById(field + '-error');
        
        if (data.valid) {
            fieldElement.classList.remove('is-invalid');
            fieldElement.classList.add('is-valid');
            errorElement.textContent = '';
        } else {
            fieldElement.classList.remove('is-valid');
            fieldElement.classList.add('is-invalid');
            errorElement.textContent = data.errors[field][0];
        }
    });
}

// Attach to form fields
document.querySelectorAll('input[data-validate]').forEach(input => {
    input.addEventListener('blur', function() {
        validateField(this.name, this.value);
    });
});</code></pre>
            </div>

            <h2 id="security-features">Security Features</h2>

            <div class="alert alert-warning">
                <i class="fas fa-shield-alt me-2"></i>
                <strong>Security:</strong> Always validate on server-side. Client-side validation is for user experience only.
            </div>

            <h3>Input Sanitization</h3>
            <div class="code-example" data-title="Data Sanitization">
                <pre><code class="language-php"><?php
class Validator
{
    public function sanitize($data, $rules = [])
    {
        $sanitized = [];
        
        foreach ($data as $key => $value) {
            $sanitized[$key] = $this->sanitizeValue($value, $rules[$key] ?? []);
        }
        
        return $sanitized;
    }
    
    protected function sanitizeValue($value, $rules)
    {
        // Trim whitespace
        $value = trim($value);
        
        // Apply sanitization rules
        foreach ($rules as $rule) {
            switch ($rule) {
                case 'email':
                    $value = filter_var($value, FILTER_SANITIZE_EMAIL);
                    break;
                case 'url':
                    $value = filter_var($value, FILTER_SANITIZE_URL);
                    break;
                case 'string':
                    $value = filter_var($value, FILTER_SANITIZE_STRING);
                    break;
                case 'int':
                    $value = filter_var($value, FILTER_SANITIZE_NUMBER_INT);
                    break;
            }
        }
        
        return $value;
    }
}</code></pre>
            </div>

            <div class="alert alert-success">
                <i class="fas fa-check-circle me-2"></i>
                <strong>Best Practice:</strong> Combine validation with sanitization for maximum security and data integrity.
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>