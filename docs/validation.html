<section id="validation" class="content-section active">
    <div class="page-header">
        <h1 class="page-title">Validation System</h1>
        <p class="page-subtitle">Comprehensive input validation for secure applications</p>
    </div>

    <div class="toc">
        <h6>Table of Contents</h6>
        <ul>
            <li><a href="#validation-basics">Validation Basics</a></li>
            <li><a href="#validation-rules">Available Rules</a></li>
            <li><a href="#custom-validation">Custom Validation</a></li>
            <li><a href="#controller-validation">Controller Integration</a></li>
        </ul>
    </div>

    <h2 id="validation-basics">Validation Basics</h2>
    <p>The validation service provides a comprehensive system for validating user input with built-in rules and custom validation support.</p>

    <h3>Basic Usage</h3>
    <div class="code-example" data-title="Simple Validation">
        <pre><code class="language-php"><?php
use Core\Validation\ValidationService;

$validator = new ValidationService();

$data = [
    'name' => 'John Doe',
    'email' => 'john@example.com',
    'age' => 25
];

$rules = [
    'name' => ['required', ['min_length', 2]],
    'email' => ['required', 'email'],
    'age' => ['required', ['min_value', 18]]
];

if ($validator->validate($data, $rules)) {
    echo "Validation passed!";
} else {
    $errors = $validator->getErrors();
    foreach ($errors as $field => $fieldErrors) {
        echo "$field: " . implode(', ', $fieldErrors) . "\n";
    }
}</code></pre>
    </div>

    <h2 id="validation-rules">Available Rules</h2>

    <h3>Basic Rules</h3>
    <div class="code-example" data-title="Basic Validation Rules">
        <pre><code class="language-php"><?php
$rules = [
    // Required field
    'name' => ['required'],
    
    // Email validation
    'email' => ['required', 'email'],
    
    // String length
    'username' => [['min_length', 3], ['max_length', 20]],
    
    // Numeric values
    'age' => [['min_value', 18], ['max_value', 120]],
    
    // Unique in database
    'email' => [['unique', 'user', 'email']],
    
    // Exists in database
    'department_id' => [['exists', 'departments', 'id']],
    
    // Confirmation field
    'password_confirm' => [['same_as', 'password']],
    
    // Regular expression
    'phone' => [['regex', '/^\d{3}-\d{3}-\d{4}$/']],
    
    // In array
    'status' => [['in', ['active', 'inactive', 'pending']]],
    
    // Date validation
    'birth_date' => ['date', ['before', '2010-01-01']]
];</code></pre>
    </div>

    <h3>Advanced Rules</h3>
    <div class="code-example" data-title="Advanced Validation">
        <pre><code class="language-php"><?php
// Complex validation with multiple conditions
$rules = [
    'password' => [
        'required',
        ['min_length', 8],
        ['regex', '/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/']
    ],
    
    // Conditional validation
    'manager_id' => [
        ['required_if', 'role', 'employee'],
        ['exists', 'user', 'id']
    ],
    
    // File validation
    'avatar' => [
        ['file_type', ['jpg', 'png', 'gif']],
        ['file_size', 2048] // Max 2MB
    ],
    
    // Array validation
    'tags' => [
        'array',
        ['array_min', 1],
        ['array_max', 10]
    ]
];</code></pre>
    </div>

    <h2 id="custom-validation">Custom Validation</h2>

    <h3>Custom Rule Classes</h3>
    <div class="code-example" data-title="Custom Validation Rule">
        <pre><code class="language-php"><?php
// app/_Core/Validation/Rules/StrongPassword.php
namespace Core\Validation\Rules;

class StrongPassword
{
    public function validate($field, $value, $parameters = [])
    {
        if (empty($value)) return true; // Let 'required' handle empty values
        
        $hasLower = preg_match('/[a-z]/', $value);
        $hasUpper = preg_match('/[A-Z]/', $value);
        $hasNumber = preg_match('/\d/', $value);
        $hasSpecial = preg_match('/[@$!%*?&]/', $value);
        
        return $hasLower && $hasUpper && $hasNumber && $hasSpecial;
    }
    
    public function getMessage($field, $value, $parameters = [])
    {
        return "{$field} must contain lowercase, uppercase, number and special character";
    }
}

// Register custom rule
$validator->addCustomRule('strong_password', StrongPassword::class);

// Use custom rule
$rules = [
    'password' => ['required', 'strong_password']
];</code></pre>
    </div>

    <h3>Inline Custom Validation</h3>
    <div class="code-example" data-title="Inline Validation">
        <pre><code class="language-php"><?php
// Custom validation function
$rules = [
    'username' => [
        'required',
        function($field, $value) {
            if (in_array(strtolower($value), ['admin', 'root', 'system'])) {
                return "Username '{$value}' is reserved";
            }
            return true;
        }
    ]
];</code></pre>
    </div>

    <h2 id="controller-validation">Controller Integration</h2>

    <h3>Validation in Controllers</h3>
    <div class="code-example" data-title="Controller Validation">
        <pre><code class="language-php"><?php
class UserController extends Controller
{
    public function createAction()
    {
        if ($this->isPost()) {
            $data = $this->getRequest()->all();
            
            $validation = $this->validateUser($data);
            if (!$validation['valid']) {
                $this->flashError('Validation failed');
                return $this->render('user/form', [
                    'data' => $data,
                    'errors' => $validation['errors']
                ]);
            }
            
            // Create user if validation passes
            $user = User::create($data);
            $this->flashSuccess('User created successfully');
            return $this->redirect('admin/user');
        }
        
        return $this->render('user/form');
    }
    
    protected function validateUser(array $data, $excludeId = null): array
    {
        $validator = $this->getDI()->get('validation');
        
        $rules = [
            'name' => ['required', ['min_length', 2]],
            'email' => [
                'required',
                'email',
                ['unique', 'user', 'email', $excludeId]
            ],
            'custom_id' => [
                'required',
                ['unique', 'user', 'custom_id', $excludeId]
            ],
            'password' => ['required', ['min_length', 6]],
            'department' => [['in', ['IT', 'HR', 'Sales', 'Marketing']]]
        ];
        
        if ($validator->validate($data, $rules)) {
            return ['valid' => true];
        }
        
        return [
            'valid' => false,
            'errors' => $validator->getErrors()
        ];
    }
}</code></pre>
    </div>

    <h3>Displaying Validation Errors</h3>
    <div class="code-example" data-title="Error Display in Views">
        <pre><code class="language-php"><?php // In view template ?>
<form method="post">
    <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <input type="text" class="form-control <?= isset($errors['name']) ? 'is-invalid' : '' ?>" 
               id="name" name="name" value="<?= $this->escape($data['name'] ?? '') ?>">
        <?php if (isset($errors['name'])): ?>
            <div class="invalid-feedback">
                <?= $this->escape(implode(', ', $errors['name'])) ?>
            </div>
        <?php endif; ?>
    </div>
    
    <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control <?= isset($errors['email']) ? 'is-invalid' : '' ?>" 
               id="email" name="email" value="<?= $this->escape($data['email'] ?? '') ?>">
        <?php if (isset($errors['email'])): ?>
            <div class="invalid-feedback">
                <?= $this->escape(implode(', ', $errors['email'])) ?>
            </div>
        <?php endif; ?>
    </div>
    
    <button type="submit" class="btn btn-primary">Save</button>
</form></code></pre>
    </div>

    <div class="alert alert-success">
        <i class="fas fa-shield-alt me-2"></i>
        <strong>Security Best Practice:</strong> Always validate on the server side, even if you have client-side validation.
    </div>
</section>