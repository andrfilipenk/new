<?php
/**
 * Default Textarea Field Template
 * 
 * Template for rendering textarea fields
 * 
 * Available variables:
 * @var \Core\Forms\Fields\TextAreaField $field The field instance
 * @var array $context Rendering context
 * @var array $options Rendering options
 */

// Get field data
$fieldName = $field->getName();
$fieldId = $field->getAttribute('id', $fieldName);
$fieldLabel = $field->getLabel();
$fieldHelp = $field->getHelpText();
$fieldValue = $field->getValue();
$isRequired = $field->isRequired();

// Get errors
$errors = $context['errors'][$fieldName] ?? [];
if (!is_array($errors)) {
    $errors = [$errors];
}
$hasErrors = !empty($errors);

// Build attributes
$attributes = $field->getAttributes();
if ($hasErrors) {
    $classes = $attributes['class'] ?? '';
    $attributes['class'] = trim($classes . ' is-invalid');
}

// Build attribute string
$attrString = '';
foreach ($attributes as $name => $value) {
    if (is_bool($value)) {
        $attrString .= $value ? ' ' . htmlspecialchars($name, ENT_QUOTES, 'UTF-8') : '';
    } else {
        $attrString .= sprintf(
            ' %s="%s"',
            htmlspecialchars($name, ENT_QUOTES, 'UTF-8'),
            htmlspecialchars($value, ENT_QUOTES, 'UTF-8')
        );
    }
}
?>
<div class="form-field textarea-field<?= $hasErrors ? ' has-error' : '' ?>">
    <?php if ($fieldLabel): ?>
    <label for="<?= htmlspecialchars($fieldId, ENT_QUOTES, 'UTF-8') ?>" class="field-label">
        <?= htmlspecialchars($fieldLabel, ENT_QUOTES, 'UTF-8') ?>
        <?php if ($isRequired): ?>
        <span class="required-indicator" aria-label="required">*</span>
        <?php endif; ?>
    </label>
    <?php endif; ?>
    
    <textarea<?= $attrString ?>><?= htmlspecialchars($fieldValue ?? '', ENT_QUOTES, 'UTF-8') ?></textarea>
    
    <?php if ($fieldHelp): ?>
    <small class="field-help"><?= htmlspecialchars($fieldHelp, ENT_QUOTES, 'UTF-8') ?></small>
    <?php endif; ?>
    
    <?php if ($hasErrors): ?>
    <div class="field-errors">
        <?php foreach ($errors as $error): ?>
        <div class="field-error"><?= htmlspecialchars($error, ENT_QUOTES, 'UTF-8') ?></div>
        <?php endforeach; ?>
    </div>
    <?php endif; ?>
</div>
