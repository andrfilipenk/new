<?php $this->layout('layout/enterprise'); ?>

<!-- Toolbar -->
<div class="enterprise-toolbar">
    <div class="enterprise-breadcrumb">
        <a href="/">Home</a>
        <span class="enterprise-breadcrumb__separator">/</span>
        <span>Projects</span>
    </div>
    
    <div class="enterprise-toolbar__actions">
        <a href="/projects/create" class="enterprise-button enterprise-button--primary">
            <span class="enterprise-icon">➕</span>
            New Project
        </a>
    </div>
</div>

<!-- Filters Bar -->
<div class="enterprise-filters">
    <form method="GET" action="/projects" class="enterprise-filters__form">
        <div class="enterprise-filters__group">
            <select name="status" class="enterprise-input enterprise-input--select">
                <option value="">All Statuses</option>
                <?php foreach ($statuses as $status): ?>
                    <option value="<?= htmlspecialchars($status) ?>" <?= ($filters['status'] === $status) ? 'selected' : '' ?>>
                        <?= htmlspecialchars($status) ?>
                    </option>
                <?php endforeach; ?>
            </select>
        </div>
        
        <div class="enterprise-filters__group">
            <input type="date" name="date_from" class="enterprise-input" placeholder="Start Date" 
                   value="<?= htmlspecialchars($filters['date_from'] ?? '') ?>">
        </div>
        
        <div class="enterprise-filters__group">
            <input type="date" name="date_to" class="enterprise-input" placeholder="End Date"
                   value="<?= htmlspecialchars($filters['date_to'] ?? '') ?>">
        </div>
        
        <div class="enterprise-filters__group">
            <input type="text" name="search" class="enterprise-input" placeholder="Search projects..."
                   value="<?= htmlspecialchars($filters['search'] ?? '') ?>">
        </div>
        
        <button type="submit" class="enterprise-button enterprise-button--secondary">Apply Filters</button>
        <a href="/projects" class="enterprise-button enterprise-button--ghost">Reset</a>
    </form>
</div>

<!-- Summary Stats -->
<div class="project-stats-row">
    <div class="enterprise-metric-card">
        <div class="enterprise-metric-card__label">Total Projects</div>
        <div class="enterprise-metric-card__value"><?= $totalStats['total_projects'] ?></div>
    </div>
    <div class="enterprise-metric-card">
        <div class="enterprise-metric-card__label">Active Projects</div>
        <div class="enterprise-metric-card__value"><?= $totalStats['active_projects'] ?></div>
    </div>
    <div class="enterprise-metric-card">
        <div class="enterprise-metric-card__label">Completed Projects</div>
        <div class="enterprise-metric-card__value"><?= $totalStats['completed_projects'] ?></div>
    </div>
</div>

<!-- Projects Card Grid -->
<div class="project-card-grid">
    <?php foreach ($projects as $projectData): ?>
        <?php 
            $project = $projectData['project'];
            $metrics = $projectData['metrics'];
        ?>
        
        <div class="enterprise-card project-card">
            <div class="project-card__header">
                <h3 class="project-card__title"><?= htmlspecialchars($project->name) ?></h3>
                <span class="enterprise-badge enterprise-badge--<?= $project->getStatusBadgeClass() ?>">
                    <?= htmlspecialchars($project->status) ?>
                </span>
            </div>
            
            <div class="project-card__code">
                Project Code: <?= htmlspecialchars($project->code) ?>
            </div>
            
            <div class="project-card__body">
                <?php if ($project->client): ?>
                    <div class="project-card__info">
                        <strong>Client:</strong> <?= htmlspecialchars($project->client->name ?? 'N/A') ?>
                    </div>
                <?php endif; ?>
                
                <div class="project-card__info">
                    <strong>Duration:</strong> 
                    <?= date('M d, Y', strtotime($project->start_date)) ?> - 
                    <?= $project->end_date ? date('M d, Y', strtotime($project->end_date)) : 'Ongoing' ?>
                </div>
            </div>
            
            <div class="project-card__metrics">
                <div class="project-card__metric">
                    <div class="project-card__metric-label">Orders</div>
                    <div class="project-card__metric-value"><?= $metrics['orders']['total'] ?></div>
                </div>
                <div class="project-card__metric">
                    <div class="project-card__metric-label">Budget</div>
                    <div class="project-card__metric-value"><?= round($metrics['budget']['utilization']) ?>%</div>
                </div>
                <div class="project-card__metric">
                    <div class="project-card__metric-label">Team</div>
                    <div class="project-card__metric-value"><?= $metrics['team']['size'] ?></div>
                </div>
            </div>
            
            <div class="project-card__stats">
                <div class="project-card__stat">
                    <span class="project-card__stat-label">Ready:</span>
                    <span class="project-card__stat-value"><?= $metrics['orders']['ready'] ?></span>
                </div>
                <div class="project-card__stat">
                    <span class="project-card__stat-label">Active:</span>
                    <span class="project-card__stat-value"><?= $metrics['orders']['active'] ?></span>
                </div>
                <div class="project-card__stat">
                    <span class="project-card__stat-label">Hours:</span>
                    <span class="project-card__stat-value"><?= round($metrics['team']['hours_logged']) ?></span>
                </div>
            </div>
            
            <div class="project-card__footer">
                <div class="project-card__updated">
                    Updated: <?= date('M d, Y', strtotime($project->updated_at)) ?>
                </div>
                <div class="project-card__actions">
                    <a href="/projects/<?= $project->id ?>" class="enterprise-button enterprise-button--primary enterprise-button--sm">
                        View Details
                    </a>
                    <button class="enterprise-button enterprise-button--ghost enterprise-button--sm">⋮</button>
                </div>
            </div>
        </div>
    <?php endforeach; ?>
</div>

<!-- Pagination -->
<?php if ($pagination['total_pages'] > 1): ?>
<div class="enterprise-pagination">
    <div class="enterprise-pagination__info">
        Showing page <?= $pagination['current_page'] ?> of <?= $pagination['total_pages'] ?>
        (<?= $pagination['total'] ?> total projects)
    </div>
    <div class="enterprise-pagination__controls">
        <?php if ($pagination['current_page'] > 1): ?>
            <a href="?page=<?= $pagination['current_page'] - 1 ?>" class="enterprise-button enterprise-button--sm">Previous</a>
        <?php endif; ?>
        
        <?php for ($i = 1; $i <= min($pagination['total_pages'], 5); $i++): ?>
            <a href="?page=<?= $i ?>" class="enterprise-button enterprise-button--sm <?= $i === $pagination['current_page'] ? 'enterprise-button--primary' : '' ?>">
                <?= $i ?>
            </a>
        <?php endfor; ?>
        
        <?php if ($pagination['current_page'] < $pagination['total_pages']): ?>
            <a href="?page=<?= $pagination['current_page'] + 1 ?>" class="enterprise-button enterprise-button--sm">Next</a>
        <?php endif; ?>
    </div>
</div>
<?php endif; ?>
