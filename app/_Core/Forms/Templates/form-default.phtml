<?php
/**
 * Default Form Layout Template
 * 
 * Main template for rendering complete forms with all fields,
 * errors, and CSRF protection.
 * 
 * Available variables:
 * @var \Core\Forms\FormDefinition $form The form definition
 * @var array $context Rendering context
 * @var array $options Rendering options
 */

// Get form data
$formName = $form->getName();
$formAction = $form->getAction();
$formMethod = $form->getMethod();
$formEnctype = $form->getEnctype();
$formAttributes = $form->getFormAttributes();

// Get fields
$fields = $form->getFields();

// Get global errors
$globalErrors = $context['global_errors'] ?? [];
$fieldErrors = $context['errors'] ?? [];

// CSRF
$csrfEnabled = $form->isCsrfEnabled();
$csrfField = $context['csrf_field'] ?? '';

// Render options
$showLabels = $options['show_labels'] ?? true;
$showSubmitButton = $options['show_submit_button'] ?? true;
$submitButtonText = $options['submit_button_text'] ?? 'Submit';
$submitButtonClass = $options['submit_button_class'] ?? 'btn-submit';

// Build form attributes
$formAttrString = '';
foreach ($formAttributes as $name => $value) {
    $formAttrString .= sprintf(
        ' %s="%s"',
        htmlspecialchars($name, ENT_QUOTES, 'UTF-8'),
        htmlspecialchars($value, ENT_QUOTES, 'UTF-8')
    );
}
?>
<form 
    name="<?= htmlspecialchars($formName, ENT_QUOTES, 'UTF-8') ?>" 
    action="<?= htmlspecialchars($formAction, ENT_QUOTES, 'UTF-8') ?>" 
    method="<?= htmlspecialchars($formMethod, ENT_QUOTES, 'UTF-8') ?>"
    <?php if ($formEnctype): ?>
    enctype="<?= htmlspecialchars($formEnctype, ENT_QUOTES, 'UTF-8') ?>"
    <?php endif; ?>
    <?= $formAttrString ?>
>
    <?php if (!empty($globalErrors)): ?>
    <div class="form-errors global-errors">
        <?php foreach ($globalErrors as $error): ?>
        <div class="form-error"><?= htmlspecialchars($error, ENT_QUOTES, 'UTF-8') ?></div>
        <?php endforeach; ?>
    </div>
    <?php endif; ?>
    
    <?php if ($csrfEnabled && $csrfField): ?>
    <?= $csrfField ?>
    <?php endif; ?>
    
    <div class="form-fields">
        <?php foreach ($fields as $field): ?>
        <?php
        // Skip hidden fields from standard rendering
        if ($field->getType() === 'hidden') {
            echo $field->render($context);
            continue;
        }
        ?>
        
        <div class="form-group">
            <?= $field->render($context) ?>
        </div>
        <?php endforeach; ?>
    </div>
    
    <?php if ($showSubmitButton): ?>
    <div class="form-actions">
        <button type="submit" class="<?= htmlspecialchars($submitButtonClass, ENT_QUOTES, 'UTF-8') ?>">
            <?= htmlspecialchars($submitButtonText, ENT_QUOTES, 'UTF-8') ?>
        </button>
    </div>
    <?php endif; ?>
</form>
